{% extends "base.html" %}

{% load humanize %}
{% load static %}
{% load widget_tweaks %}

{% block head %}
<link rel="stylesheet" href="{% static 'main/css/home.css' %}">
{% endblock %}

{% block content %}

<header class="filters-bar bg-white py-3 px-5 mb-4">
  <div class="container-fluid">
    <form method="get">
      <input type="hidden" name="page" value="1">
      <div class="row g-3">

        <!-- üîΩ Marka -->
        <div class="col-6 col-md-4 col-lg-2 filter-col">
          <label class="form-label fw-semibold small">Marka</label>
          <div class="dropdown w-100">
            <button class="btn btn-outline-secondary w-100 text-start filter-btn" type="button" data-bs-toggle="dropdown">
              Wybierz
            </button>
            <div class="dropdown-menu p-2 shadow filter-dropdown">
              {% for checkbox in filter.form.brand %}
              <div class="form-check">
                {{ checkbox.tag }}
                <label class="form-check-label text-wrap">{{ checkbox.choice_label }}</label>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- üîΩ Rodzaj paliwa -->
        <div class="col-6 col-md-4 col-lg-2 filter-col">
          <label class="form-label fw-semibold small">Rodzaj paliwa</label>
          <div class="dropdown w-100">
            <button class="btn btn-outline-secondary w-100 text-start filter-btn" type="button" data-bs-toggle="dropdown">
              Wybierz
            </button>
            <div class="dropdown-menu p-2 shadow filter-dropdown">
              {% for checkbox in filter.form.fuel %}
              <div class="form-check">
                {{ checkbox.tag }}
                <label class="form-check-label text-wrap">{{ checkbox.choice_label }}</label>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- üîΩ Napƒôd -->
        <div class="col-6 col-md-4 col-lg-2 filter-col">
          <label class="form-label fw-semibold small">Napƒôd</label>
          <div class="dropdown w-100">
            <button class="btn btn-outline-secondary w-100 text-start filter-btn" type="button" data-bs-toggle="dropdown">
              Wybierz
            </button>
            <div class="dropdown-menu p-2 shadow filter-dropdown">
              {% for checkbox in filter.form.drive %}
              <div class="form-check">
                {{ checkbox.tag }}
                <label class="form-check-label text-wrap">{{ checkbox.choice_label }}</label>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- üîΩ Skrzynia -->
        <div class="col-6 col-md-4 col-lg-2 filter-col">
          <label class="form-label fw-semibold small">Skrzynia bieg√≥w</label>
          <div class="dropdown w-100">
            <button class="btn btn-outline-secondary w-100 text-start filter-btn" type="button" data-bs-toggle="dropdown">
              Wybierz
            </button>
            <div class="dropdown-menu p-2 shadow filter-dropdown">
              {% for checkbox in filter.form.transmission %}
              <div class="form-check">
                {{ checkbox.tag }}
                <label class="form-check-label text-wrap">{{ checkbox.choice_label }}</label>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- üîΩ Typ nadwozia -->
        <div class="col-6 col-md-4 col-lg-2 filter-col">
          <label class="form-label fw-semibold small">Typ nadwozia</label>
          <div class="dropdown w-100">
            <button class="btn btn-outline-secondary w-100 text-start filter-btn" type="button" data-bs-toggle="dropdown">
              Wybierz
            </button>
            <div class="dropdown-menu p-2 shadow filter-dropdown">
              {% for checkbox in filter.form.type %}
              <div class="form-check">
                {{ checkbox.tag }}
                <label class="form-check-label text-wrap">{{ checkbox.choice_label }}</label>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- üîΩ Rok -->
        <div class="col-6 col-md-4 col-lg-2 filter-col">
          <label class="form-label fw-semibold small">Rok produkcji</label>
          <div class="input-group">
            {{ filter.form.production_year__gte|add_class:"form-control form-control-sm text-center" }}
            <span class="input-group-text">-</span>
            {{ filter.form.production_year__lte|add_class:"form-control form-control-sm text-center" }}
          </div>
        </div>

        <!-- üîΩ Cena -->
        <div class="col-6 col-md-4 col-lg-2 filter-col">
          <label class="form-label fw-semibold small">Cena (PLN)</label>
          <div class="input-group">
            {{ filter.form.price__gte|add_class:"form-control form-control-sm text-center" }}
            <span class="input-group-text">-</span>
            {{ filter.form.price__lte|add_class:"form-control form-control-sm text-center" }}
          </div>
        </div>

        <!-- üîΩ Przebieg -->
        <div class="col-6 col-md-4 col-lg-2 filter-col">
          <label class="form-label fw-semibold small">Przebieg (km)</label>
          <div class="input-group">
            {{ filter.form.mileage_km__gte|add_class:"form-control form-control-sm text-center" }}
            <span class="input-group-text">-</span>
            {{ filter.form.mileage_km__lte|add_class:"form-control form-control-sm text-center" }}
          </div>
        </div>

      </div>

      <!-- üîò Przyciski -->
      <div class="d-flex gap-2 mt-4 justify-content-end">
        <button type="submit" class="btn btn-primary px-4">Filtruj</button>
        <a href="{% url 'home' %}" class="btn btn-outline-secondary px-4">Wyczy≈õƒá</a>
      </div>
    </form>
  </div>
</header>

<main>
    
    <h1 class="h2 fw-bold my-4 text-center">Samochody osobowe - {{filtered_count}} ofert</h1>
    <ul class="list-unstyled container my-4">
        {% for offer in page_obj %}
            <li class="mb-4">
                <a href="#" class="text-decoration-none text-dark">
                <article class="p-4 border rounded shadow-sm offer-card bg-white d-flex align-items-start">

                    {% if offer.image %}
                        <div class="offer-image-wrapper me-4">
                            <img src="{{ offer.image.url }}" alt="Zdjƒôcie og≈Çoszenia" class="offer-image">
                        </div>
                    {% else %}
                        <div class="offer-image-wrapper me-4 d-flex align-items-center justify-content-center bg-light text-muted">
                            <span>Brak zdjƒôcia</span>
                        </div>
                    {% endif %}

                    <div class="offer-details flex-grow-1">

                        <!-- Tytu≈Ç i cena w jednej linii -->
                        <div class="d-flex justify-content-between align-items-start mb-1">
                            <h1 class="h5 fw-bold mb-0">
                                {{ offer.car.vehicle_brand }}
                                {% if offer.car.vehicle_model %} {{ offer.car.vehicle_model }}{% endif %}
                                {% if offer.car.vehicle_version %} {{ offer.car.vehicle_version }}{% endif %}
                            </h1>

                            <div class="offer-price h5 fw-bold">{{ offer.price }} PLN</div>
                        </div>

                        <h4 class="h6 text-secondary mb-3">
                            {{ offer.car.displacement_cm3 }} cm¬≥ ‚Ä¢ {{ offer.car.power_hp }} KM
                        </h4>

                        <h3 class="h6 mb-3 text-muted">
                            <i class="fa-solid fa-road me-1"></i>{{ offer.car.mileage_km }} km
                            <span class="mx-2">‚Ä¢</span>
                            <i class="fa-solid fa-gas-pump me-1"></i>{{ offer.car.fuel_type }}
                            <span class="mx-2">‚Ä¢</span>
                            <i class="fa-solid fa-gears me-1"></i>{{ offer.car.transmission }}
                            <span class="mx-2">‚Ä¢</span>
                            <i class="fa-solid fa-calendar me-1"></i>{{ offer.car.production_year }}
                        </h3>

                        <address class="text-muted small mb-1">
                            <i class="fa-solid fa-user me-1"></i>{{ offer.seller.first_name }}
                            <span class="mx-2">‚Ä¢</span>
                            <i class="fa-solid fa-location-dot me-1"></i>{{ offer.offer_location }}
                        </address>

                        <p class="text-muted small mb-0">
                            Opublikowano {{ offer.offer_publication_date|naturaltime }}
                        </p>
                    </div>
                </article>
                </a>
            </li>
        {% endfor %}
    </ul>

   <nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination justify-content-center">

        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if query_params %}&{{ query_params }}{% endif %}">‚Üê Poprzednia</a>
            </li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">‚Üê Poprzednia</span></li>
        {% endif %}

        <li class="page-item disabled">
            <span class="page-link">Strona {{ page_obj.number }} z {{ page_obj.paginator.num_pages }}</span>
        </li>

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if query_params %}&{{ query_params }}{% endif %}">Nastƒôpna ‚Üí</a>
            </li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">Nastƒôpna ‚Üí</span></li>
        {% endif %}

    </ul>
  </nav>

{% endblock %}